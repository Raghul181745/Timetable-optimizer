<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Check Slots</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        th {
            background: #4CAF50;
            color: white;
        }
        tr:nth-child(even) {
            background: #f2f2f2;
        }
        a {
            display: block;
            width: fit-content;
            margin: 20px auto;
            padding: 10px 15px;
            text-decoration: none;
            color: white;
            background: #4CAF50;
            border-radius: 5px;
        }
        a:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>Check Available Slots</h1>


    <form method="POST" style="margin-bottom: 20px;">
        <label>Staff Name:</label>
        <input type="text" name="staff_name" value="{{ staff_name or '' }}" required>
        <label>Department:</label>
        <input type="text" name="department" value="{{ department or '' }}" required>
        <label>Year:</label>
        <input type="text" name="year" value="{{ request.form.get('year', '') }}">
        <label>Semester:</label>
        <input type="text" name="semester" value="{{ request.form.get('semester', '') }}">
        <button type="submit">Check</button>
    </form>

    <form method="POST" style="margin-bottom: 20px;">
        <input type="hidden" name="staff_name" value="{{ staff_name or '' }}">
        <input type="hidden" name="department" value="{{ department or '' }}">
        <input type="hidden" name="year" value="{{ request.form.get('year', '') }}">
        <input type="hidden" name="semester" value="{{ request.form.get('semester', '') }}">
        <label>Auto Assign Subject:</label>
        <input type="text" name="subject" placeholder="Subject">
        <button type="submit" name="auto_assign" value="1">Auto Assign</button>
    </form>

    {% if message %}
        <p style="color: green;">{{ message }}</p>
    {% endif %}

    {% if slots %}
    <table>
        <thead>
            <tr>
                <th>Day</th>
                {% for i in range(slots|length) %}
                    <th>{{ i+1 }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for day_idx in range(days|length) %}
            <tr>
                <td>{{ days[day_idx] }}</td>
                {% for slot in slots %}
                    <td>
                        {% set cell = slot.slots[day_idx] %}
                        {% if cell.entry_id %}
                            {{ cell.subject }}
                            <form method="POST" action="{{ url_for('delete_slot', entry_id=cell.entry_id) }}" style="display:inline;">
                                <button type="submit" onclick="return confirm('Delete this slot?');">Delete</button>
                            </form>
                        {% else %}
                            Free
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No slots available. Please search for a staff and department.</p>
    {% endif %}

    <a href="{{ url_for('dashboard') }}">Back to Dashboard</a>
</body>
</html>
